---
import type { Props } from '@astrojs/starlight/props';
import Default from '@astrojs/starlight/components/Header.astro';
---

<Default {...Astro.props}><slot /></Default>

<script>
  function addDashboardLink() {
    const rightGroup = document.querySelector('header.header .right-group');
    if (rightGroup && !rightGroup.querySelector('.dashboard-link')) {
      const link = document.createElement('a');
      link.href = 'https://sprites.dev/account';
      link.className = 'dashboard-link';
      link.target = '_blank';
      link.rel = 'noopener noreferrer';
      link.innerHTML = `Dashboard <svg class="external-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.22 14.78a.75.75 0 001.06 0l7.22-7.22v5.69a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75h-7.5a.75.75 0 000 1.5h5.69l-7.22 7.22a.75.75 0 000 1.06z" clip-rule="evenodd" /></svg>`;
      rightGroup.appendChild(link);
    }
  }

  function applyGlassmorphism() {
    const header = document.querySelector('header.header') as HTMLElement;
    if (header) {
      const isDark = document.documentElement.dataset.theme !== 'light';
      header.style.backdropFilter = 'blur(10px) saturate(180%)';
      header.style.setProperty('-webkit-backdrop-filter', 'blur(10px) saturate(180%)');
      header.style.background = isDark
        ? 'rgba(12, 10, 9, 0.7)'
        : 'rgba(255, 255, 255, 0.7)';
      header.style.borderBottom = isDark
        ? '1px solid rgba(255, 255, 255, 0.1)'
        : '1px solid rgba(0, 0, 0, 0.1)';
    }
  }

  // Watch for theme changes
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.attributeName === 'data-theme') {
        applyGlassmorphism();
      }
    });
  });
  observer.observe(document.documentElement, { attributes: true });

  addDashboardLink();
  applyGlassmorphism();
  document.addEventListener('astro:page-load', () => {
    addDashboardLink();
    applyGlassmorphism();
  });
</script>

<style is:global>
  .dashboard-link {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.875rem;
    font-family: 'Fricolage Grotesque', -apple-system, BlinkMacSystemFont, sans-serif;
    font-size: 0.875rem;
    font-weight: 500;
    letter-spacing: -0.01em;
    color: white;
    text-decoration: none;
    background: linear-gradient(180deg, #22c55e 0%, #16a34a 100%);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 0.375rem;
    box-shadow:
      0 1px 2px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.15);
  }

  .dashboard-link:hover {
    background: linear-gradient(180deg, #2dd464 0%, #1eb854 100%);
  }

  .dashboard-link .external-icon {
    width: 0.875rem;
    height: 0.875rem;
    opacity: 0.8;
  }
</style>
